function vlUploader(e){var r,t=e.file,o="type"in e?e.type:0,a="url"in e?e.url:"",n="complete"in e?e.complete:function(){},i="progress"in e?e.progress:function(e){},u="error"in e?e.error:function(e,r){},l="start"in e?e.start:function(e,r){},s=t.lastModified||t.lastModifiedDate||"00",c=new FileReader,p=1048576,d=0;function f(){var e=d,r=d+p,o=t.slice(e,r);c.readAsDataURL(o)}c.onload=function(e){if(!e.target.error){if(d+p>t.size)var o=t.size-d;else o=p;$.ajax({url:"/ajax/vluploader.php",type:"post",dataType:"json",data:{action:"upload",url:a,token:r,filesize:o,data:e.target.result},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var r,a;e.lengthComputable&&i&&(a=o*(e.loaded/e.total),r=d+a,r/=t.size,i(r>=1?.9999:r))},e},success:function(e){1==e.result?(i((d+=p)/t.size),f()):2==e.result?n():-1==e.result?u(e.error,!0):(u(e.error),setTimeout(f,5e3))},error:function(){u("An error has occurred. Retrying..."),setTimeout(f,5e3)}})}},$.ajax({url:"/ajax/vluploader.php",type:"post",dataType:"json",data:{action:"check",filename:t.name,filesize:t.size,filetype:t.type,modified:s,url:a,type:o},success:function(e){1==e.result?(a=e.url,r=e.token,l(a,e.thumb),f()):2==e.result?(a=e.url,r=e.token,d=e.uploaded,l(a,e.thumb),f()):u(e.error,!0)},error:function(){u("An error has occurred. Upload aborted!",!0)}})}