function ChannelBannerEditor(e){function t(t,n,s){e.find("> ul").remove();var i=$("<ul></ul>");for(var o in s)if(null!=s[o]){var r=$("<li>"+o+"</li>");r.click(s[o]),r.click(h),i.append(r)}0>t?t=0:t>e.width()&&(t=e.width()),0>n?n=0:n>e.height()&&(n=e.height()),i.css({left:t,top:n}),i.contextmenu(function(){return $(this).remove(),!1}),i.mousedown(!1),e.append(i)}function n(t,n){var s=parseInt(t.css("left")),i=parseInt(t.css("top")),o=t.outerWidth(),r=t.outerHeight();0>s&&t.css("left",s=0),0>i&&t.css("top",i=0),s+o>e.width()&&t.css("left",s=e.width()-o),i+r>e.height()&&t.css("top",i=e.height()-r),s+o>e.width()&&t.css("width",e.width()-s),i+r>e.height()&&t.css("height",e.height()-i)}function s(t){e.off("click","> a"),t[0].click(),e.on("click","> a",!1)}function i(e){var t=prompt("Please, enter your link:",e.attr("href"));null!=t&&e.attr("href",t)}function o(t,s){var i=$('<a target="_blank"></a>');i.css({left:t,top:s,width:50,height:50}),e.append(i),n(i)}function r(){e.find("> a").remove()}function c(t){a=t.pageX-e.offset().left-3,l=t.pageY-e.offset().top-3}function u(e){null!=f&&(clearInterval(f),f=null)}function h(){e.find("> ul").remove()}var f,a=0,l=0;this.destroy=function(){$(document).unbind("mousemove",c),$(document).unbind("mouseup",u),$(document).unbind("mousedown contextmenu",h),e.removeClass("channel_banner_editor"),e.find("> a").css("cursor",""),e.find("> ul").remove(),e.find("*").unbind(),e.unbind()},this.save=function(){for(var t=[],n=e.width()/100,s=e.height()/100,i=e.find("> a"),o=0;o<i.length;o++)t.push({href:i.eq(o).attr("href"),width:i.eq(o).outerWidth()/n,height:i.eq(o).outerHeight()/s,left:parseInt(i.eq(o).css("left"))/n,top:parseInt(i.eq(o).css("top"))/s});return JSON.stringify(t)},e.mousedown(function(){return e.find("> ul").remove(),!1}),e.contextmenu(function(e){var n=a,s=l;return t(a,l,{"Add Link":function(){o(n,s)},"Clear Links":r}),!1}),e.on("click","> a",!1),e.on("contextmenu","> a",function(){var e=$(this);return t(a,l,{"Open Link":e.attr("href")?function(){s(e)}:null,"Edit Link":function(){i(e)},"Remove Link":function(){e.remove()}}),!1}),e.on("mousemove mousedown","> a",function(t){if(("mousedown"!=t.type||1==t.which)&&null==f){var s=a-parseInt($(this).css("left")),i=l-parseInt($(this).css("top")),o=$(this).outerWidth(),r=$(this).outerHeight();if("mousemove"==t.type)5>s&&5>i?$(this).css("cursor","nw-resize"):5>s&&i>r-5?$(this).css("cursor","sw-resize"):5>s?$(this).css("cursor","w-resize"):s>o-5&&5>i?$(this).css("cursor","ne-resize"):5>i?$(this).css("cursor","n-resize"):s>o-5&&i>r-5?$(this).css("cursor","nw-resize"):s>o-5?$(this).css("cursor","w-resize"):i>r-5?$(this).css("cursor","s-resize"):$(this).css("cursor","move");else{var c,u,h,d,p=$(this),m=parseInt(p.css("left")),v=parseInt(p.css("top")),w=e.width(),g=e.height(),k=p.outerWidth(),I=p.outerHeight(),b=a,z=l,q=!0,x=!1,y=!1,L=!1,_=!1;if(5>s&&5>i?(x=!0,L=!0):5>s&&i>r-5?(x=!0,_=!0):5>s?x=!0:s>o-5&&5>i?(L=!0,y=!0):5>i?L=!0:s>o-5&&i>r-5?(_=!0,y=!0):s>o-5?y=!0:i>r-5?_=!0:q=!1,q)f=setInterval(function(){x?(c=k+(b-a),h=m-(b-a),0>c&&(c*=-1,h=m+k)):y&&(c=k+(a-b),h=m,0>c&&(c*=-1,h=m-c)),L?(u=I+(z-l),d=v-(z-l),0>u&&(u*=-1,d=v+I)):_&&(u=I+(l-z),d=v,0>u&&(u*=-1,d=v-u)),0>h&&(c+=h,h=0),0>d&&(u+=d,d=0),c+h>w&&(c-=c+h-w),u+d>g&&(u-=u+d-g),p.css("left",h),p.css("top",d),p.css("width",c),p.css("height",u),n(p)},13);else{var p=$(this),m=parseInt(p.css("left")),v=parseInt(p.css("top")),b=a,z=l;f=setInterval(function(){p.css({left:m+a-b,top:v+l-z}),n(p)},13)}}}}),$(document).mousemove(c),$(document).mouseup(u),$(document).on("mousedown contextmenu",h),e.addClass("channel_banner_editor")}